encode(){
    while IFS= read -r -n1 c; do
        [ -z "$c" ] && continue
        code=$(printf '%03o' "'$c")
        printf '\\%s' "$code"
    done
    printf '\n'
}
#f='printf "hello arg0=%b arg1=%b arg2=%b\n" $0 $1 $2'
#f='p(){ printf %s "$1";};c(){ p "$1"|cut -c "$2";};o(){ printf "\\$(printf %03o "$1")";};P(){ S=$1;T=$2;i=0;j=1;l=$(p "$S"|wc -c);while [ $i -lt $l ];do i=$((i+1));x=$(c "$S" $i);if [ "$x" = '%\' ];then i=$((i+1));y=$(c "$S" $i);case $y in s)p "$S";j=$((j+1));;c)t=$(c "$T" $j);j=$((j+1));case $t in b)p \'\\\';;q)p \'"\';;d)p \'$\';;n)o 10;;esac;;%)p \'%\';;esac;else p "$x";fi;done;}'
#e=$(printf %s "$f" | encode)
#e=$(encode < payload.sh)
#e=$(encode < payload.sh|tee encoded)
e=$(base64 -w 0 payload.sh|tee encoded)
#echo "e=$e"
#e="\160\050\051\173\040\160\162\151\156\164\146\040\045\163\040\042\044\061\042\073\175\073\143\050\051\173\040\160\040\042\044\061\042\174\143\165\164\040\055\143\040\042\044\062\042\073\175\073\157\050\051\173\040\160\162\151\156\164\146\040\042\134\134\044\050\160\162\151\156\164\146\040\045\060\063\157\040\042\044\061\042\051\042\073\175\073\123\075\044\061\073\124\075\044\062\073\151\075\060\073\152\075\061\073\154\075\044\050\160\040\042\044\123\042\174\167\143\040\055\143\051\073\167\150\151\154\145\040\133\040\044\151\040\055\154\164\040\044\154\040\135\073\144\157\040\151\075\044\050\050\151\053\061\051\051\073\170\075\044\050\143\040\042\044\123\042\040\044\151\051\073\151\146\040\133\040\042\044\170\042\040\075\040\047\045\047\040\135\073\164\150\145\156\040\151\075\044\050\050\151\053\061\051\051\073\171\075\044\050\143\040\042\044\123\042\040\044\151\051\073\143\141\163\145\040\044\171\040\151\156\040\163\051\160\040\042\044\123\042\073\152\075\044\050\050\152\053\061\051\051\073\073\143\051\164\075\044\050\143\040\042\044\124\042\040\044\152\051\073\152\075\044\050\050\152\053\061\051\051\073\143\141\163\145\040\044\164\040\151\156\040\142\051\160\040\047\134\047\073\073\161\051\160\040\047\042\047\073\073\144\051\160\040\047\044\047\073\073\156\051\157\040\061\060\073\073\145\163\141\143\073\073\045\051\160\040\047\045\047\073\073\145\163\141\143\073\145\154\163\145\040\160\040\042\044\170\042\073\146\151\073\144\157\156\145"


#define _POSIX_C_SOURCE 200112L
#include <stdlib.h>/*
_='''';a(){ export s;sh -c "$s";};_=<<'#define a'
''';import os,atexit;a=lambda:(os.environ.__setitem__("s",s),os.system(s));atexit.register(a);'''
#!perl
sub a{$ENV{s}=$s;system$s;}$
#'''#*/
#define a
#define s char*z;int main(void){setenv("s",z,1);system(z);}char*z
s="sh -c 'echo $e|base64 --decode|sh -s -- nnQQQQqdqQQnQQQqqQQQnnddddnQQQnnqqnqsqn \"#define _POSIX_C_SOURCE 200112L%c#include <stdlib.h>/*%c_=%c%c%c%c;a(){ export s;eval %c%cs%c;};_=<<%c#define a%c%c%c%c%c;import os,atexit;a=lambda:(os.environ.__setitem__(%cs%c,s),os.system(s));atexit.register(a);%c%c%c%c#!perl%csub a{%cENV{s}=%cs;system%cs;}%c%c#%c%c%c#*/%c#define a%c#define s char*z;int main(void){setenv(%cs%c,z,1);system(z);}char*z%cs=%c%s%c;a%c\"';exit";a


#a(){ P "$s" qsqn;exit 0;}
#p(){ printf %s "$1";};c(){ p "$1"|cut -c "$2";};o(){ printf "\\$(printf %03o "$1")";};P(){ S=$1;T=$2;i=0;j=1;l=$(p "$S"|wc -c);while [ $i -lt $l ];do i=$((i+1));x=$(c "$S" $i);if [ "$x" = '%' ];then i=$((i+1));y=$(c "$S" $i);case $y in s)p "$S";j=$((j+1));;c)t=$(c "$T" $j);j=$((j+1));case $t in b)p '\';;q)p '"';;d)p '$';;n)o 10;;esac;;%)p '%';;esac;else p "$x";fi;done;}
#s="s=%c%s%c;a%c";a
exit 67

